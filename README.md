Online-Store
===============================================================================

Проект распределённой системы онлайн-магазина.

- **Generator** -выпоняет роль клиента,
отправляет сгенерированный заказ http запросом на эндпоинт сервиса ***Store***

- **Store** - Выполняет роль сервера принимающего заказы от ***Generator***,
асинхронно отправляет заказ в брокер сообщений (***kafka***)

- **Loyalty** - Выполняет роль потребителя оформленных заказов.
Получает оформленные заказы от брокера сообщений по одному.
Цель сервиса, расчёт бонусных баллов для начислений покупателю (не реализовано).

- **Dashboard** - Выполняет роль потребителя оформленных заказов.
Получает минимум по десять оформленных заказов от брокера сообщений.
Цель сервиса, аналитические отчеты (не реализовано).

## Запуск проекта

*Запуск производится в докер-контейнере, поэтому должен быть установлен docker.
Установка docker выходит за рамки этой инстукции и вы можете ознакомиться с порядком установки сами [Get Docker](https://docs.docker.com/get-started/get-docker/).*

Всё что нужно это скопировать проект, перейти через терминал в загруженную директорию и выполнить команду запуска контейнеров docker с помощью compose.yaml файла:
```sh
git clone git@github.com:niksmo/online-store.git
cd online-store
docker compose up -d
```

Проект запустится с настройками по умолчанию. Вы можете изменить их через значения переменных окружения.

О настройках каждого сервиса будет написано ниже.

Чтобы убедиться в работоспособности запущенной системы, подключитесь к стандартному потоку вывода `sdterr` необходимого вам контейнера (сервиса),
как это сделать через терминал см. здесь [docker container logs](https://docs.docker.com/reference/cli/docker/container/logs/)

## Подробнее о каждом сервисе

### Сервис Generator
Генерирует заказы соответствующие схеме:
```typescript
interface Scheme.Order {
    userID: number,
    orderID: number,
    items: Product[],
    totalPrice: number,
    date: string
}

interface Scheme.Product {
    id: number,
    name: string,
    price: number
}
```
Заказы отправляет восемь (по умолчанию) воркеров одновременно, между отправками каждый воркер ожидает от 400 до 5000 миллисекунд.

Переменные окружения сервиса:

- `N_WORKERS` - Количество одновременно работающих воркеров отправки заказов, по умолчанию **8**
- `URL_ADDRESS` - URL эндроинта сервиса ***Store***, по умолчанию **http://Store:8000/**


### Сервис Store
Бэкенд онлайн-магазина, прослушивает 8000 порт (по умолчанию).

Принимает заказы POST запросом на эндпоинт `/`.

После предполагаемого создания записи в базе данных отправляет заказ брокеру сообщений.

Оформленный заказ логирует в `stderr` перед отправкой.

Результат отправки брокеру сообщения также логирует в `stderr`.

Переменные окружения сервиса:

- `SERVER_ADDRESS` - Адрес сервера, например `localhost:5050` или `:8000`, по умолчанию `:8000`
- `KAFKA_SERVERS` - Адреса брокеров разделённые запятой, по умолчанию `kafka-1:9094,kafka-2:9094`
- `KAFKA_TOPIC` - Название топика для отправки сообщения с оформленным заказом, по умолчанию `orders_create`


### Сервис Loyalty
Сервис лояльности. Запускается в двух экземплярах.

Получает сообщения (по одному за раз) с оформленными заказами от брокера сообщений для предполагаемого расчёта бонусных баллов.

Заказ из полученного сообщения логирует в `stderr`.

Переменные окружения сервиса:

- `KAFKA_SERVERS` - Адреса брокеров разделённые запятой, по умолчанию `kafka-1:9094,kafka-2:9094`
- `KAFKA_TOPIC` - Название топика для получения сообщения с оформленным заказом, по умолчанию `orders_create`
- `KAFKA_CONSUMER_GROUP` - ID группы, должен быть уникальный,
чтобы другие получатели могли получить все сообщения из брокера. По умолчанию `0`


### Сервис Dashboard
Сервис аналитики. Запускается в двух экземплярах.

Получает сообщения (минимум по 10 за раз) с оформленными заказами от брокера сообщений для предполагаемой аналитики по заказам.

Заказ из полученного сообщения логирует в `stderr`.

Переменные окружения сервиса:

- `KAFKA_SERVERS` - Адреса брокеров разделённые запятой, по умолчанию `kafka-1:9094,kafka-2:9094`
- `KAFKA_TOPIC` - Название топика для получения сообщения с оформленным заказом, по умолчанию `orders_create`
- `KAFKA_CONSUMER_GROUP` - ID группы, должен быть уникальный,
чтобы другие получатели могли получить все сообщения из брокера. По умолчанию `1`
